{"componentChunkName":"component---src-templates-blog-post-js","path":"/django/drf-annotate/","result":{"data":{"site":{"siteMetadata":{"title":"Blog"}},"markdownRemark":{"id":"476d819c-f8e4-513b-9bc4-1175cd35bd72","excerpt":"Contents ğŸ”· ìš”êµ¬ ì‚¬í•­ [ğŸ”· ë¬¸ì œ ìƒí™©](#-ğŸ”·-ë¬¸ì œ ìƒí™©) ğŸ”· í•´ê²° 1. ViewSetì˜ get_queryset ìˆ˜ì •í•˜ê¸° 2. models.Manager í™œìš©í•˜ê¸° ğŸ”· ìš”êµ¬ ì‚¬í•­ ê³µì—° ìƒíƒœ ê¸°ì¤€ìœ¼ë¡œ ê³µì—° ëª©ë¡ í•„í„°ë§ (e.gâ€¦","html":"<h1>Contents</h1>\n<ul>\n<li><a href=\"#-%F0%9F%94%B7-%EC%9A%94%EA%B5%AC-%EC%82%AC%ED%95%AD\">ğŸ”· ìš”êµ¬ ì‚¬í•­</a></li>\n<li>[ğŸ”· ë¬¸ì œ ìƒí™©](#-ğŸ”·-ë¬¸ì œ ìƒí™©)</li>\n<li><a href=\"#-%F0%9F%94%B7-%ED%95%B4%EA%B2%B0\">ğŸ”· í•´ê²°</a>\n<ul>\n<li><a href=\"##-1.-ViewSet%EC%9D%98-get_queryset-%EC%88%98%EC%A0%95%ED%95%98%EA%B8%B0\">1. ViewSetì˜ get_queryset ìˆ˜ì •í•˜ê¸°</a></li>\n<li><a href=\"##-2.-models.Manager-%ED%99%9C%EC%9A%A9%ED%95%98%EA%B8%B0\">2. models.Manager í™œìš©í•˜ê¸°</a></li>\n</ul>\n</li>\n</ul>\n<br>\n<br>\n<h1>ğŸ”· ìš”êµ¬ ì‚¬í•­</h1>\n<ul>\n<li>ê³µì—° ìƒíƒœ ê¸°ì¤€ìœ¼ë¡œ ê³µì—° ëª©ë¡ í•„í„°ë§\n<ul>\n<li>(e.g.) <code class=\"language-text\">/performance?status=ì˜ˆì •</code></li>\n</ul>\n</li>\n</ul>\n<h1>ğŸ”· ë¬¸ì œ ìƒí™©</h1>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token comment\"># models.py</span>\n<span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span>\n\n<span class=\"token keyword\">from</span> django<span class=\"token punctuation\">.</span>db <span class=\"token keyword\">import</span> models\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">Performance</span><span class=\"token punctuation\">(</span>models<span class=\"token punctuation\">.</span>Model<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    genre <span class=\"token operator\">=</span> models<span class=\"token punctuation\">.</span>ForeignKey<span class=\"token punctuation\">(</span>Genre<span class=\"token punctuation\">,</span> on_delete<span class=\"token operator\">=</span>models<span class=\"token punctuation\">.</span>CASCADE<span class=\"token punctuation\">,</span> related_name<span class=\"token operator\">=</span><span class=\"token string\">'performances'</span><span class=\"token punctuation\">,</span> verbose_name<span class=\"token operator\">=</span><span class=\"token string\">'ì¥ë¥´'</span><span class=\"token punctuation\">)</span>\n    code <span class=\"token operator\">=</span> models<span class=\"token punctuation\">.</span>CharField<span class=\"token punctuation\">(</span>max_length<span class=\"token operator\">=</span><span class=\"token number\">100</span><span class=\"token punctuation\">,</span> unique<span class=\"token operator\">=</span><span class=\"token boolean\">True</span><span class=\"token punctuation\">,</span> verbose_name<span class=\"token operator\">=</span><span class=\"token string\">'KOPIS ê³µì—°ID'</span><span class=\"token punctuation\">)</span>\n    name <span class=\"token operator\">=</span> models<span class=\"token punctuation\">.</span>CharField<span class=\"token punctuation\">(</span>max_length<span class=\"token operator\">=</span><span class=\"token number\">255</span><span class=\"token punctuation\">,</span> verbose_name<span class=\"token operator\">=</span><span class=\"token string\">'ê³µì—°ëª…'</span><span class=\"token punctuation\">)</span>\n    price <span class=\"token operator\">=</span> models<span class=\"token punctuation\">.</span>IntegerField<span class=\"token punctuation\">(</span>verbose_name<span class=\"token operator\">=</span><span class=\"token string\">'í‹°ì¼“ ê°€ê²©'</span><span class=\"token punctuation\">,</span> null<span class=\"token operator\">=</span><span class=\"token boolean\">False</span><span class=\"token punctuation\">,</span> default<span class=\"token operator\">=</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span>\n    started_at <span class=\"token operator\">=</span> models<span class=\"token punctuation\">.</span>DateField<span class=\"token punctuation\">(</span>verbose_name<span class=\"token operator\">=</span><span class=\"token string\">'ê³µì—° ì‹œì‘ì¼'</span><span class=\"token punctuation\">)</span>\n    ended_at <span class=\"token operator\">=</span> models<span class=\"token punctuation\">.</span>DateField<span class=\"token punctuation\">(</span>verbose_name<span class=\"token operator\">=</span><span class=\"token string\">'ê³µì—° ì¢…ë£Œì¼'</span><span class=\"token punctuation\">)</span>\n\n    <span class=\"token keyword\">def</span> <span class=\"token function\">get_status</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        <span class=\"token string\">\"ê³µì—° ìƒíƒœ ë°˜í™˜\"</span>\n        today <span class=\"token operator\">=</span> datetime<span class=\"token punctuation\">.</span>today<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>date<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">if</span> self<span class=\"token punctuation\">.</span>started_at <span class=\"token operator\">&lt;=</span> today <span class=\"token operator\">&lt;=</span> self<span class=\"token punctuation\">.</span>ended_at<span class=\"token punctuation\">:</span>\n            <span class=\"token keyword\">return</span> <span class=\"token string\">\"ê³µì—° ì¤‘\"</span>\n        <span class=\"token keyword\">elif</span> today <span class=\"token operator\">></span> self<span class=\"token punctuation\">.</span>ended_at<span class=\"token punctuation\">:</span>\n            <span class=\"token keyword\">return</span> <span class=\"token string\">\"ì¢…ë£Œ\"</span>\n        <span class=\"token keyword\">else</span><span class=\"token punctuation\">:</span>\n            <span class=\"token keyword\">return</span> <span class=\"token string\">\"ì˜ˆì •\"</span></code></pre></div>\n<ul>\n<li>\n<p>ê³µì—° ìƒíƒœëŠ” <code class=\"language-text\">get_status</code>ë¼ëŠ” ì¸ìŠ¤í„´ìŠ¤ ë©”ì†Œë“œë¡œ íŒë³„ ë˜ê³  ìˆìŒ</p>\n</li>\n<li>\n<p>ORM ì¿¼ë¦¬ì…‹ì—ì„œ ì§ì ‘ í•„í„°ë§ í•  ìˆ˜ ì—†ìŒ</p>\n<p>â†’ âœ¨Â <code class=\"language-text\">annotate()</code>ë¥¼ í™œìš©í•´ì„œ ì¿¼ë¦¬ì…‹ì— í•„ë“œ ì¶”ê°€ í•´ì•¼ í•¨</p>\n</li>\n</ul>\n<h1>ğŸ”· í•´ê²°</h1>\n<h2>1. <code class=\"language-text\">ViewSet</code>ì˜ <code class=\"language-text\">get_queryset</code> ìˆ˜ì •í•˜ê¸°</h2>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token comment\"># serializers.py</span>\n<span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span>\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">PerformanceSerializer</span><span class=\"token punctuation\">(</span>serializers<span class=\"token punctuation\">.</span>ModelSerializer<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    genre <span class=\"token operator\">=</span> GenreSerializer<span class=\"token punctuation\">(</span>read_only<span class=\"token operator\">=</span><span class=\"token boolean\">True</span><span class=\"token punctuation\">)</span>\n    status <span class=\"token operator\">=</span> serializers<span class=\"token punctuation\">.</span>CharField<span class=\"token punctuation\">(</span>source<span class=\"token operator\">=</span><span class=\"token string\">'get_status'</span><span class=\"token punctuation\">,</span> read_only<span class=\"token operator\">=</span><span class=\"token boolean\">True</span><span class=\"token punctuation\">)</span>\n\n    <span class=\"token keyword\">class</span> <span class=\"token class-name\">Meta</span><span class=\"token punctuation\">:</span>\n        model <span class=\"token operator\">=</span> Performance\n        fields <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'id'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'genre'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'name'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'status'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'price'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'started_at'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ended_at'</span><span class=\"token punctuation\">]</span>\n\n<span class=\"token comment\"># views.py</span>\n<span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span>\n\n<span class=\"token keyword\">from</span> django<span class=\"token punctuation\">.</span>db<span class=\"token punctuation\">.</span>models <span class=\"token keyword\">import</span> Case<span class=\"token punctuation\">,</span> When<span class=\"token punctuation\">,</span> Value<span class=\"token punctuation\">,</span> CharField\n<span class=\"token keyword\">from</span> rest_framework <span class=\"token keyword\">import</span> viewsets<span class=\"token punctuation\">,</span> mixins\n<span class=\"token keyword\">from</span> <span class=\"token punctuation\">.</span>models <span class=\"token keyword\">import</span> Performance\n<span class=\"token keyword\">from</span> <span class=\"token punctuation\">.</span>serializers <span class=\"token keyword\">import</span> PerformanceSerializer\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">PerformanceViewSet</span><span class=\"token punctuation\">(</span>mixins<span class=\"token punctuation\">.</span>ListModelMixin<span class=\"token punctuation\">,</span>\n                         mixins<span class=\"token punctuation\">.</span>RetrieveModelMixin<span class=\"token punctuation\">,</span>\n                         viewsets<span class=\"token punctuation\">.</span>GenericViewSet<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token triple-quoted-string string\">\"\"\"ê³µì—° ë¦¬ìŠ¤íŠ¸ ë° ìƒì„¸ ì¡°íšŒ API\"\"\"</span>\n    serializer_class <span class=\"token operator\">=</span> PerformanceSerializer\n\n    <span class=\"token keyword\">def</span> <span class=\"token function\">get_queryset</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        <span class=\"token triple-quoted-string string\">\"\"\"âœ… `status`ë¥¼ í•„ë“œì²˜ëŸ¼ ì‚¬ìš© ê°€ëŠ¥í•˜ë„ë¡ `annotate()` í™œìš©\"\"\"</span>\n        today <span class=\"token operator\">=</span> datetime<span class=\"token punctuation\">.</span>today<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>date<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n        queryset <span class=\"token operator\">=</span> Performance<span class=\"token punctuation\">.</span>objects<span class=\"token punctuation\">.</span>select_related<span class=\"token punctuation\">(</span><span class=\"token string\">'genre'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>annotate<span class=\"token punctuation\">(</span>\n            status<span class=\"token operator\">=</span>Case<span class=\"token punctuation\">(</span>\n                When<span class=\"token punctuation\">(</span>started_at__lte<span class=\"token operator\">=</span>today<span class=\"token punctuation\">,</span> ended_at__gte<span class=\"token operator\">=</span>today<span class=\"token punctuation\">,</span> then<span class=\"token operator\">=</span>Value<span class=\"token punctuation\">(</span><span class=\"token string\">\"ê³µì—° ì¤‘\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n                When<span class=\"token punctuation\">(</span>ended_at__lt<span class=\"token operator\">=</span>today<span class=\"token punctuation\">,</span> then<span class=\"token operator\">=</span>Value<span class=\"token punctuation\">(</span><span class=\"token string\">\"ì¢…ë£Œ\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n                default<span class=\"token operator\">=</span>Value<span class=\"token punctuation\">(</span><span class=\"token string\">\"ì˜ˆì •\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n                output_field<span class=\"token operator\">=</span>CharField<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">)</span>\n\n        status <span class=\"token operator\">=</span> self<span class=\"token punctuation\">.</span>request<span class=\"token punctuation\">.</span>query_params<span class=\"token punctuation\">.</span>get<span class=\"token punctuation\">(</span><span class=\"token string\">'status'</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">None</span><span class=\"token punctuation\">)</span>\n        \n        <span class=\"token keyword\">if</span> status<span class=\"token punctuation\">:</span>\n            queryset <span class=\"token operator\">=</span> queryset<span class=\"token punctuation\">.</span><span class=\"token builtin\">filter</span><span class=\"token punctuation\">(</span>status<span class=\"token operator\">=</span>status<span class=\"token punctuation\">)</span>\n\n        <span class=\"token keyword\">return</span> queryset</code></pre></div>\n<ul>\n<li>\n<p>ê³µì—° ìƒíƒœ(<code class=\"language-text\">status</code>) ê¸°ì¤€ìœ¼ë¡œ í•„í„°ë§ ê°€ëŠ¥ ğŸ™ƒ</p>\n</li>\n<li>\n<p>ê³µì—° ëª©ë¡ ë°ì´í„°ê°€ serializer ë  ë•Œ <code class=\"language-text\">status</code> í•„ë“œì˜ ê°’ì€ ì¸ìŠ¤í„´ìŠ¤ ë©”ì†Œë“œë¡œ ì •ì˜ëœ <code class=\"language-text\">get_status</code> ë¥¼ í†µí•´ í™•ì¸í•˜ê²Œ ë¨</p>\n<p>â†’ <code class=\"language-text\">models.py</code>ì™€ <code class=\"language-text\">views.py</code>ì— <code class=\"language-text\">status</code> ê³„ì‚° í•˜ëŠ” ì¤‘ë³µ ë¡œì§ì´ ì¡´ì¬í•˜ê²Œ ë¨</p>\n</li>\n</ul>\n<h2>2. <code class=\"language-text\">models.Manager</code> í™œìš©í•˜ê¸°</h2>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token comment\"># models.py</span>\n<span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span>\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">PerformanceManager</span><span class=\"token punctuation\">(</span>models<span class=\"token punctuation\">.</span>Manager<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">def</span> <span class=\"token function\">get_queryset</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        today <span class=\"token operator\">=</span> datetime<span class=\"token punctuation\">.</span>today<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>date<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">return</span> <span class=\"token builtin\">super</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>get_queryset<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>annotate<span class=\"token punctuation\">(</span>\n            status<span class=\"token operator\">=</span>Case<span class=\"token punctuation\">(</span>\n                When<span class=\"token punctuation\">(</span>started_at__lte<span class=\"token operator\">=</span>today<span class=\"token punctuation\">,</span> ended_at__gte<span class=\"token operator\">=</span>today<span class=\"token punctuation\">,</span> then<span class=\"token operator\">=</span>Value<span class=\"token punctuation\">(</span><span class=\"token string\">\"ê³µì—° ì¤‘\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n                When<span class=\"token punctuation\">(</span>ended_at__lt<span class=\"token operator\">=</span>today<span class=\"token punctuation\">,</span> then<span class=\"token operator\">=</span>Value<span class=\"token punctuation\">(</span><span class=\"token string\">\"ì¢…ë£Œ\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n                default<span class=\"token operator\">=</span>Value<span class=\"token punctuation\">(</span><span class=\"token string\">\"ì˜ˆì •\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n                output_field<span class=\"token operator\">=</span>CharField<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">Performance</span><span class=\"token punctuation\">(</span>models<span class=\"token punctuation\">.</span>Model<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    genre <span class=\"token operator\">=</span> models<span class=\"token punctuation\">.</span>ForeignKey<span class=\"token punctuation\">(</span>Genre<span class=\"token punctuation\">,</span> on_delete<span class=\"token operator\">=</span>models<span class=\"token punctuation\">.</span>CASCADE<span class=\"token punctuation\">,</span> related_name<span class=\"token operator\">=</span><span class=\"token string\">'performances'</span><span class=\"token punctuation\">,</span> verbose_name<span class=\"token operator\">=</span><span class=\"token string\">'ì¥ë¥´'</span><span class=\"token punctuation\">)</span>\n    code <span class=\"token operator\">=</span> models<span class=\"token punctuation\">.</span>CharField<span class=\"token punctuation\">(</span>max_length<span class=\"token operator\">=</span><span class=\"token number\">100</span><span class=\"token punctuation\">,</span> unique<span class=\"token operator\">=</span><span class=\"token boolean\">True</span><span class=\"token punctuation\">,</span> verbose_name<span class=\"token operator\">=</span><span class=\"token string\">'KOPIS ê³µì—°ID'</span><span class=\"token punctuation\">)</span>\n    name <span class=\"token operator\">=</span> models<span class=\"token punctuation\">.</span>CharField<span class=\"token punctuation\">(</span>max_length<span class=\"token operator\">=</span><span class=\"token number\">255</span><span class=\"token punctuation\">,</span> verbose_name<span class=\"token operator\">=</span><span class=\"token string\">'ê³µì—°ëª…'</span><span class=\"token punctuation\">)</span>\n    price <span class=\"token operator\">=</span> models<span class=\"token punctuation\">.</span>IntegerField<span class=\"token punctuation\">(</span>verbose_name<span class=\"token operator\">=</span><span class=\"token string\">'í‹°ì¼“ ê°€ê²©'</span><span class=\"token punctuation\">,</span> null<span class=\"token operator\">=</span><span class=\"token boolean\">False</span><span class=\"token punctuation\">,</span> default<span class=\"token operator\">=</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span>\n    started_at <span class=\"token operator\">=</span> models<span class=\"token punctuation\">.</span>DateField<span class=\"token punctuation\">(</span>verbose_name<span class=\"token operator\">=</span><span class=\"token string\">'ê³µì—° ì‹œì‘ì¼'</span><span class=\"token punctuation\">)</span>\n    ended_at <span class=\"token operator\">=</span> models<span class=\"token punctuation\">.</span>DateField<span class=\"token punctuation\">(</span>verbose_name<span class=\"token operator\">=</span><span class=\"token string\">'ê³µì—° ì¢…ë£Œì¼'</span><span class=\"token punctuation\">)</span>\n\n    objects <span class=\"token operator\">=</span> PerformanceManager<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></code></pre></div>\n<ul>\n<li><code class=\"language-text\">models.Manager</code> ì˜ <code class=\"language-text\">get_queryset()</code> ì„ ìˆ˜ì •í•˜ì—¬ ê³µì—° ë°ì´í„°ë¥¼ ì¡°íšŒ í•  ë•Œ status í•„ë“œê°€ ì¶”ê°€ ë  ìˆ˜ ìˆë„ë¡ í•¨</li>\n<li><code class=\"language-text\">ViewSet</code>ì—ì„œ ì‚¬ìš©í•˜ëŠ” <code class=\"language-text\">queryset</code>ì€ <code class=\"language-text\">model.Manager</code>ê°€ ë°˜í™˜í•˜ëŠ” ì¿¼ë¦¬ì…‹ì„ ê¸°ë°˜í•˜ê¸° ë•Œë¬¸ì— <code class=\"language-text\">annotate()</code> ë¡œì§ì„ modelì— ì‘ì„±</li>\n</ul>\n<h3>âœ… serializers ìˆ˜ì •</h3>\n<ul>\n<li><code class=\"language-text\">Performance</code> ëª¨ë¸ì˜ <code class=\"language-text\">queryset</code>ì—ì„œ <code class=\"language-text\">status</code>ë¥¼ <code class=\"language-text\">annotate()</code>ë¡œ ì¶”ê°€í–ˆê¸° ë•Œë¬¸ì—, <code class=\"language-text\">Serializer</code>ì—ì„œ <code class=\"language-text\">source='status'</code>ë¥¼ ì§€ì •í•  í•„ìš”ê°€ ì—†ìŒ</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">from</span> rest_framework <span class=\"token keyword\">import</span> serializers\n<span class=\"token keyword\">from</span> performance<span class=\"token punctuation\">.</span>models <span class=\"token keyword\">import</span> Performance\n<span class=\"token keyword\">from</span> genre<span class=\"token punctuation\">.</span>serializers <span class=\"token keyword\">import</span> GenreSerializer\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">PerformanceSerializer</span><span class=\"token punctuation\">(</span>serializers<span class=\"token punctuation\">.</span>ModelSerializer<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    genre <span class=\"token operator\">=</span> GenreSerializer<span class=\"token punctuation\">(</span>read_only<span class=\"token operator\">=</span><span class=\"token boolean\">True</span><span class=\"token punctuation\">)</span>\n    status <span class=\"token operator\">=</span> serializers<span class=\"token punctuation\">.</span>CharField<span class=\"token punctuation\">(</span>read_only<span class=\"token operator\">=</span><span class=\"token boolean\">True</span><span class=\"token punctuation\">)</span>  <span class=\"token comment\"># âœ… source ì œê±°</span>\n\n    <span class=\"token keyword\">class</span> <span class=\"token class-name\">Meta</span><span class=\"token punctuation\">:</span>\n        model <span class=\"token operator\">=</span> Performance\n        fields <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'id'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'genre'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'name'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'status'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'price'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'started_at'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ended_at'</span><span class=\"token punctuation\">]</span>\n</code></pre></div>\n<h3>âœ… ìµœì¢… view</h3>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">from</span> rest_framework <span class=\"token keyword\">import</span> viewsets<span class=\"token punctuation\">,</span> mixins\n<span class=\"token keyword\">from</span> <span class=\"token punctuation\">.</span>models <span class=\"token keyword\">import</span> Performance\n<span class=\"token keyword\">from</span> <span class=\"token punctuation\">.</span>serializers <span class=\"token keyword\">import</span> PerformanceSerializer\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">PerformanceViewSet</span><span class=\"token punctuation\">(</span>mixins<span class=\"token punctuation\">.</span>ListModelMixin<span class=\"token punctuation\">,</span>\n                         mixins<span class=\"token punctuation\">.</span>RetrieveModelMixin<span class=\"token punctuation\">,</span>\n                         viewsets<span class=\"token punctuation\">.</span>GenericViewSet<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token triple-quoted-string string\">\"\"\"ê³µì—° ë¦¬ìŠ¤íŠ¸ ë° ìƒì„¸ ì¡°íšŒ API\"\"\"</span>\n    serializer_class <span class=\"token operator\">=</span> PerformanceSerializer\n\n    <span class=\"token keyword\">def</span> <span class=\"token function\">get_queryset</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        queryset <span class=\"token operator\">=</span> Performance<span class=\"token punctuation\">.</span>objects<span class=\"token punctuation\">.</span>select_related<span class=\"token punctuation\">(</span><span class=\"token string\">'genre'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token builtin\">all</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        status <span class=\"token operator\">=</span> self<span class=\"token punctuation\">.</span>request<span class=\"token punctuation\">.</span>query_params<span class=\"token punctuation\">.</span>get<span class=\"token punctuation\">(</span><span class=\"token string\">'status'</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">None</span><span class=\"token punctuation\">)</span>\n\n        <span class=\"token keyword\">if</span> status<span class=\"token punctuation\">:</span>\n            queryset <span class=\"token operator\">=</span> queryset<span class=\"token punctuation\">.</span><span class=\"token builtin\">filter</span><span class=\"token punctuation\">(</span>status<span class=\"token operator\">=</span>status<span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">return</span> queryset</code></pre></div>\n<blockquote>\n<p><a href=\"https://docs.djangoproject.com/en/5.1/ref/models/querysets/#annotate\">django-annotate</a>\n<a href=\"https://stackoverflow.com/questions/56909019/annotations-in-django-with-model-managers\">stackoverflow</a></p>\n</blockquote>","frontmatter":{"title":"ğŸ“Œ DRF - annotate & serializer field","date":"February 19, 2025","description":"ORMì˜ annotateë¥¼ serializer fieldë¡œ ì‚¬ìš©í•˜ê¸°"}},"previous":{"fields":{"slug":"/django/drf-pagination/"},"frontmatter":{"title":"ğŸ“Œ DRF í†ºì•„ë³´ê¸° - Pagination"}},"next":null},"pageContext":{"id":"476d819c-f8e4-513b-9bc4-1175cd35bd72","previousPostId":"c35c230f-7b77-5573-92d5-3f1446f10511","nextPostId":null}},"staticQueryHashes":["2841359383","3257411868"],"slicesMap":{}}