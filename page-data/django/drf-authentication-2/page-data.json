{"componentChunkName":"component---src-templates-blog-post-js","path":"/django/drf-authentication-2/","result":{"data":{"site":{"siteMetadata":{"title":"Blog"}},"markdownRemark":{"id":"e447f1ae-3754-59bd-8b34-734d65e86e87","excerpt":"👮 이전 포스팅 Contents 1. dj-rest-auth에서 JWT 사용하기 세팅 파일에 (dj-rest-auth) JWT 설정 추가하기 2. simplejwt 세팅 파일에 (djangorestframework-simplejwt) JWT 설정 추가하기 1. dj-rest-auth…","html":"<br>\n<blockquote>\n<p><a href=\"https://soojiinleee.github.io/Django/drf-authentication(01)-dj-rest-auth-&#x26;-tokenauthentication/\">👮 <em>이전 포스팅</em></a></p>\n</blockquote>\n<br>\n<h1>Contents</h1>\n<ul>\n<li><a href=\"#1-dj-rest-auth%EC%97%90%EC%84%9C-jwt-%EC%82%AC%EC%9A%A9%ED%95%98%EA%B8%B0\">1. dj-rest-auth에서 JWT 사용하기</a>\n<ul>\n<li><a href=\"#%EC%84%B8%ED%8C%85-%ED%8C%8C%EC%9D%BC%EC%97%90--dj-rest-auth--jwt-%EC%84%A4%EC%A0%95-%EC%B6%94%EA%B0%80%ED%95%98%EA%B8%B0\">세팅 파일에 (dj-rest-auth) JWT 설정 추가하기</a></li>\n</ul>\n</li>\n<li><a href=\"#2-simplejwt\">2. simplejwt</a>\n<ul>\n<li><a href=\"#%EC%84%B8%ED%8C%85-%ED%8C%8C%EC%9D%BC%EC%97%90--djangorestframework-simplejwt--jwt-%EC%84%A4%EC%A0%95-%EC%B6%94%EA%B0%80%ED%95%98%EA%B8%B0\">세팅 파일에 (djangorestframework-simplejwt) JWT 설정 추가하기</a></li>\n</ul>\n</li>\n</ul>\n<br>\n<br>\n<h1>1. dj-rest-auth에서 JWT 사용하기</h1>\n<ul>\n<li><code class=\"language-text\">Django</code>에서 <code class=\"language-text\">JWT</code>를 지원하는 <code class=\"language-text\">djangorestframework-simplejwt</code> 패키지를 통해 기본 Token 인증에서 <code class=\"language-text\">JWT</code>로 바꿀 수 있다.</li>\n<li><code class=\"language-text\">djangorestframework-simplejwt</code> 설치 후에 <code class=\"language-text\">dj-rest-auth</code>의 <code class=\"language-text\">JWT</code> 설정을 마무리 하는 것이 좋다.</li>\n</ul>\n<h2>세팅 파일에 (dj-rest-auth) JWT 설정 추가하기</h2>\n<ol>\n<li><code class=\"language-text\">REST_FRAMEWORK</code> 세팅 추가\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"> REST_FRAMEWORK <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n   <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">,</span>\n   <span class=\"token string\">'DEFAULT_AUTHENTICATION_CLASSES'</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">(</span>\n       <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n       <span class=\"token string\">'dj_rest_auth.jwt_auth.JWTCookieAuthentication'</span><span class=\"token punctuation\">,</span>\n   <span class=\"token punctuation\">)</span>\n   <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<ul>\n<li><code class=\"language-text\">dj-rest-auth</code>에서 로그인, 로그아웃 등 엔드포인트에서 인증 확인하는 로직이 있으므로 추가한다.</li>\n</ul>\n</li>\n</ol>\n<br>\n<ol start=\"2\">\n<li>\n<p><code class=\"language-text\">REST_AUTH</code> 설정 ( ✅ <strong>제일 중요</strong> )</p>\n<p>다른 블로그를 봤을 때는 <code class=\"language-text\">REST_USE_JWT = TRUE</code>로 설정하면 된다고 했지만, 올해 2월 설정 방법이 바뀐 거 같다.\n어쨌든 공식 문서에 나와 있는 대로 아래와 같이 설정한다.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\">REST_AUTH <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n <span class=\"token string\">'USE_JWT'</span><span class=\"token punctuation\">:</span> <span class=\"token boolean\">True</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>다른 설정을 제대로 했어도 <code class=\"language-text\">USE_JWT</code>를 설정하지 않으면, <code class=\"language-text\">dj-rest-auth</code>의 기본 인증 방식인 <code class=\"language-text\">Token</code>으로 진행된다.</p>\n</li>\n</ol>\n<br>\n<ol start=\"3\">\n<li>\n<p><code class=\"language-text\">REST_AUTH</code> 추가 설정</p>\n<p><code class=\"language-text\">dj-rest-auth</code> 공식문서에서 <code class=\"language-text\">Configuration</code> 중 <code class=\"language-text\">JWT</code> 관련 내용을 확인한 뒤 필요에 맞게 추가 설정을 하면 된다.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\">REST_AUTH <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">,</span>\n <span class=\"token string\">'JWT_AUTH_HTTPONLY'</span><span class=\"token punctuation\">:</span> <span class=\"token boolean\">False</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<ul>\n<li><code class=\"language-text\">JWT_AUTH_HTTPONLY</code> : <code class=\"language-text\">refresh_token</code>를 사용할 예정이라면, <strong>False</strong>로 설정을 바꿔야한다.</li>\n<li><strong>True</strong>로 설정되어 있다면 <code class=\"language-text\">refresh_token</code> 없이 아래와 같이 리턴된다.</li>\n</ul>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/16332d6271d8685143973a73ba24290d/a9965/only_access_token.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 63.92405063291139%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAAAsTAAALEwEAmpwYAAABWElEQVR42p2TW07DMBBFvf81sBaExAb4QP2hKKJ5NG0SJ01SP2I7lxmXlPIDDZaOxjO2r/y4FlJKjOOIeZ4RQoD3PkbOmd/aMup8wMPjG542JcRut8N2u0WSJEjTNKK1viz4Q/C2hTBHRFmWyLIMRVGgrmt0XQelFJxz+E8TLQk0dRPh4zeNRN/3tEsTj78Wsd+XyIsS8jRCG4dp8rDWwZiJRO3dKGXjGpFmBT6KCgc5oBvOUCtEfrAI2rOGyivomu6uOUFxXLjNq+/8fJSXftVe+rHWQrc9hCbBPj9i4CIvHBRt36yGdQztVEzO04t6ujsXcV/5Gm7XCjZxCP5q6FWvSvMn8qwhV/DnUNQXbOKmaZDnebRL27bRPgucsz95zlLjPsNjHLvuBDeRzYirIBt7GAayjI0/xRhzN5M1eE0OeC8kvbK1sbhEFluDUhrBWTxv9nhJKnwC3f3wtRjm6fwAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"only_access_token\"\n        title=\"\"\n        src=\"/static/16332d6271d8685143973a73ba24290d/f058b/only_access_token.png\"\n        srcset=\"/static/16332d6271d8685143973a73ba24290d/c26ae/only_access_token.png 158w,\n/static/16332d6271d8685143973a73ba24290d/6bdcf/only_access_token.png 315w,\n/static/16332d6271d8685143973a73ba24290d/f058b/only_access_token.png 630w,\n/static/16332d6271d8685143973a73ba24290d/40601/only_access_token.png 945w,\n/static/16332d6271d8685143973a73ba24290d/a9965/only_access_token.png 1171w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n</li>\n</ol>\n<h3>참고</h3>\n<ul>\n<li><a href=\"https://dj-rest-auth.readthedocs.io/en/latest/installation.html#json-web-token-jwt-support-optional\">dj-rest-auth JWT Support</a></li>\n<li><a href=\"https://dj-rest-auth.readthedocs.io/en/latest/configuration.html\">dj-rest-auth Configuration</a></li>\n</ul>\n<br>\n<br>\n<h1>2. SimpleJwt</h1>\n<ul>\n<li><code class=\"language-text\">JWT</code> 유효시간 설정 및 <code class=\"language-text\">blacklist</code> 등이 있어 보안 설정을 할 수 있는 라이브러리이다.</li>\n</ul>\n<h2>세팅 파일에 (djangorestframework-simplejwt) JWT 설정 추가하기</h2>\n<ol>\n<li><code class=\"language-text\">REST_FRAMEWORK</code> 세팅 추가\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\">REST_FRAMEWORK <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n <span class=\"token string\">'DEFAULT_AUTHENTICATION_CLASSES'</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">(</span>\n     <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n     <span class=\"token string\">'rest_framework_simplejwt.authentication.JWTAuthentication'</span><span class=\"token punctuation\">,</span>\n <span class=\"token punctuation\">)</span>\n <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n</li>\n</ol>\n<br>\n<ol start=\"2\">\n<li><code class=\"language-text\">INSTALLED_APPS</code> 추가\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\">INSTALLED_APPS <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span>\n <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">,</span>\n <span class=\"token string\">'rest_framework_simplejwt'</span><span class=\"token punctuation\">,</span>\n <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n<span class=\"token punctuation\">]</span></code></pre></div>\n</li>\n</ol>\n<br>\n<ol start=\"3\">\n<li>\n<p><code class=\"language-text\">SIMPLE_JWT</code> 설정</p>\n<p><code class=\"language-text\">SimpleJWT</code>의 <code class=\"language-text\">Settings</code> 에서 필요한 설정 내용 확인 후 추가하면 된다.\n<br>\n토큰 타입에 따라 유효기간 설정을 할 수 있으며, <code class=\"language-text\">access_token</code>과 <code class=\"language-text\">refresh_token</code>은 아래와 같이 설정 할 수 있다.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\">SIMPLE_JWT <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token string\">\"ACCESS_TOKEN_LIFETIME\"</span><span class=\"token punctuation\">:</span> timedelta<span class=\"token punctuation\">(</span>minutes<span class=\"token operator\">=</span><span class=\"token number\">5</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">\"REFRESH_TOKEN_LIFETIME\"</span><span class=\"token punctuation\">:</span> timedelta<span class=\"token punctuation\">(</span>days<span class=\"token operator\">=</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p><code class=\"language-text\">SIMPLE_JWT</code> 설정이 <code class=\"language-text\">dj-rest-auth</code>의 <code class=\"language-text\">LoginView</code> 등에서 사용된다. (자세한 내용은 <a href=\"https://github.com/iMerica/dj-rest-auth/blob/master/dj_rest_auth/views.py\">dj-rest-auth : views</a> 참조)</p>\n</li>\n</ol>\n<br>\n<h3>참고</h3>\n<ul>\n<li><a href=\"https://django-rest-framework-simplejwt.readthedocs.io/en/latest/getting_started.html#installation\">SimpleJWT</a></li>\n<li><a href=\"https://django-rest-framework-simplejwt.readthedocs.io/en/latest/settings.html\">SimpleJWT Settings</a></li>\n<li><a href=\"https://blog.ull.im/engineering/2019/02/07/jwt-strategy.html\">Refresh Token과 Sliding Sessions를 활용한 JWT의 보안 전략</a><br></li>\n</ul>\n<br>\n<br>\n<blockquote>\n<p>dj-rest-auth에서 JWT로 인증을 하면 외부 패키지인 SimpleJWT 이용하게 된다. dj-reat-auth에서 SimpleJWT 설정을 가져오는 경우가 있다.\n각 github 레포에서 코드까지 확인 하는 것을 추천한다.\n<br>\n<br> From 완전 상관 없는 별개라고 생각했다가 삽질한 사람 🚧</p>\n</blockquote>","frontmatter":{"title":"📌 DRF Authentication 2","date":"March 18, 2023","description":"DRF의 dj-rest-auth & JWT 적용하기"}},"previous":{"fields":{"slug":"/django/drf-authentication-1/"},"frontmatter":{"title":"📌 DRF Authentication 1"}},"next":{"fields":{"slug":"/book/practices-of-the-python-pro/"},"frontmatter":{"title":"📚 프로그래머를 위한 파이썬"}}},"pageContext":{"id":"e447f1ae-3754-59bd-8b34-734d65e86e87","previousPostId":"b88ce015-e5f1-55b4-a033-0b4bdc01d9a8","nextPostId":"60edd729-ef34-54be-9e9e-471169a06620"}},"staticQueryHashes":["2841359383","3257411868"],"slicesMap":{}}